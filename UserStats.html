<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Th·ªëng k√™</title>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js" integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.12.1/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="./assest/css/customer.css">
    <link rel="stylesheet" href="./assest/css/userStats.css">
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container d-flex">
        <!-- SIDE BAR -->
        <div class="sidebar">
            <div class="sidebar-logoHRM d-flex">
                <div class="logo-img me-2">
                    <img src="./assest/img/logoHR.png" alt="">
                </div>
                <div class="logo-text">hrms</div>
            </div>
            <div class="sidebar-content">
                <ul class="">
                    <li class="d-flex active"><span class="material-symbols-outlined">
                        widgets
                        </span><a href="./UserStats.html">Th·ªëng k√™</a></li>
                    <li class="d-flex  user-js">
                        <div class="d-flex align-items-center"><span class="material-symbols-outlined">
                            Groups
                            </span>Ng∆∞·ªùi d√πng
                             <span class="material-symbols-outlined open-drop-menu">
                                arrow_forward_ios
                                </span>
                        </div>
                       
                </li>
                <div class="drop-menu">
                    <div> <a href="./Customer.html">Kh√°ch th√†nh vi√™n</a> </div>
                    <div> <a href="./Shipper.html">Shipper</a> </div>
                    <div> <a href="./Shop.html"> C·ª≠a h√†ng</a></div>
                </div>
                    <li class="d-flex"><span class="material-symbols-outlined">
                        group_add
                        </span><a href="./resigterSales.html">Y√™u c·∫ßu ƒëƒÉng k√Ω</a></li>
                    <li class="d-flex"><span class="material-symbols-outlined">
                        settings
                        </span><a href="">C√†i ƒë·∫∑t</a></li>
                </ul>
               <div class="btn-bgr-mode d-flex">
                <button class="button-lightMode d-flex align-items-center btn-active">
                    <span class="material-symbols-outlined">
                        light_mode
                        </span>
                        Light
                </button>
                <button class="button-darkMode d-flex align-items-center">
                    <span class="material-symbols-outlined">
                        mode_night
                        </span>
                        Dark
                </button>
               </div>
            </div>
        </div>
        <!-- CONTENT -->
         <div id="content" class="d-flex">
            <div class="nav d-flex justify-content-between">
                <div class="nav-left">
                    <div class="heading">Th·ªëng k√™</div>
                    <div class="nav-text d-flex align-items-center">
                        <div>
                            Th·ªëng k√™
                        </div>
                    </div>
                </div>
                <div class="nav-right d-flex">
                    <div class="search d-flex">
                        <div class="search-icon d-flex">
                            <span class="material-symbols-outlined search-icon">
                                search
                                </span>
                        </div>
                        <input type="text" class="search-input" placeholder="T√¨m ki·∫øm">
                    </div>
                    <div class="notification d-flex align-items-center">
                        <span class="material-symbols-outlined">
                            notifications_active
                            </span>
                    </div>
                    <div class="profile d-flex align-items-center">
                        <div class="avatar">
                            <img src="./assest/img/ava.png" alt="">
                        </div>
                        <div class="profile-rules">Administrator</div>
                        <div class="drop-menu d-flex">
                            <span class="material-symbols-outlined">
                                keyboard_arrow_down
                                </span>
                        </div>
                    </div>

                </div>
            </div>
            <div class="content-main d-flex">
              <div class="content-main__infor content-tab active">
                <div class="container">
                    <h3 class="my-3">üìä Th·ªëng k√™ ng∆∞·ªùi d√πng</h3>
                    <div class="row g-3">
                    <div class="col-md-3">
                        <div class="card text-white bg-primary">
                        <div class="card-body">
                            <h5 class="card-title">T·ªïng ng∆∞·ªùi d√πng</h5>
                            <p class="card-text fs-4" id="total-users">0</p>
                        </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-white bg-success">
                        <div class="card-body">
                            <h5 class="card-title">Shipper</h5>
                            <p class="card-text fs-4" id="shipper-count">0</p>
                        </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-white bg-warning">
                        <div class="card-body">
                            <h5 class="card-title">C·ª≠a h√†ng</h5>
                            <p class="card-text fs-4" id="store-count">0</p>
                        </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-white bg-info">
                        <div class="card-body">
                            <h5 class="card-title">Kh√°ch h√†ng</h5>
                            <p class="card-text fs-4" id="customer-count">0</p>
                        </div>
                        </div>
                    </div>
                    </div>
                </div>
                <!-- Th·ªëng k√™ ƒë∆°n h√†ng ƒë√£ c√≥ -->
                 <div class="stat-section">
      <ul>
        <li>S·ªë ƒë∆°n h√†ng ƒë√£ ho√†n th√†nh: <strong id="approvedOrdersCount">ƒêang t·∫£i...</strong></li>
        <li>T·ªïng ti·ªÅn h·ªá th·ªëng thu ƒë∆∞·ª£c: <strong id="totalRevenue">ƒêang t·∫£i...</strong></li>
      </ul>
    </div>

    <div class="stat-section">
      <h4>Bi·ªÉu ƒë·ªì doanh thu theo th√°ng</h4>
      <canvas id="revenueChart" height="100"></canvas>
    </div>

                </div>
            </div>
         </div>
    </div>
    <script type="module" src="./assest/js/common.js"></script>
    <script type="module" src="./assest/js/userStats.js"></script>
      <script>
    // Firebase config
    const firebaseConfig = {
        apiKey: "AIzaSyCsIyn4exh4s5aM_sMEAtVksy6FKznP7Xk",
        authDomain: "monngontainha-75d8e.firebaseapp.com",
        projectId: "monngontainha-75d8e",
        storageBucket: "monngontainha-75d8e.firebasestorage.app",
        messagingSenderId: "623705308892",
        appId: "1:623705308892:web:95e37f944352418b81fe19"
        };


    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const months = Array.from({ length: 12 }, (_, i) => `Th√°ng ${i + 1}`);
    const monthlyRevenue = new Array(12).fill(0);
    let totalRevenue = 0;
    let approvedCount = 0;

   db.collection("DonHang")
  .where("trangThaiDonHang", "==", "DaGiaoHang")
  .get()
  .then((querySnapshot) => {
    querySnapshot.forEach((doc) => {
      const data = doc.data();

      const date = data.thoiGianDatHang.toDate(); 
      const month = date.getMonth(); 

      const tongTien = Number(data.tongTien) || 0;
      const phiShip = Number(data.phiShip) || 0;
      const revenue = (tongTien - phiShip) * 0.3 + phiShip * 0.15;

      totalRevenue += revenue;
      monthlyRevenue[month] += revenue;
      approvedCount++;
    });

    console.log("Doanh thu theo th√°ng:", monthlyRevenue);

    document.getElementById("approvedOrdersCount").innerText = approvedCount;
    document.getElementById("totalRevenue").innerText = totalRevenue.toLocaleString("vi-VN") + "ƒë";

    const ctx = document.getElementById("revenueChart").getContext("2d");
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: months,
        datasets: [{
          label: 'Doanh thu h·ªá th·ªëng (VND)',
          data: monthlyRevenue,
          backgroundColor: 'rgba(54, 162, 235, 0.6)',
          borderColor: 'rgb(54, 162, 235)',
          borderWidth: 1
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              callback: (value) => value.toLocaleString("vi-VN") + "ƒë"
            }
          }
        }
      }
    });
  });
  </script>


</body>
</html>